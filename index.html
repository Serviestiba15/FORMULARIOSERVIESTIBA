<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema de Gestión de Reclamos</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .table-container { max-height: 600px; overflow-y: auto; }
    .modal { display: none; }
    .modal-active { display: flex; }
    #otroContainer { display: none; }
    .hidden { display: none !important; }
    .badge { border-radius: 9999px; padding: 2px 10px; font-size: 12px; }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <script type="module">
    
    /* ------------------------ IMPORTS FIREBASE (CDN) ------------------------ */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import {
      getFirestore, collection, query, onSnapshot, addDoc, serverTimestamp,
      doc, updateDoc, arrayUnion, getDocs, setDoc
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    /* ----------------------- CONFIGURACIÓN DE FIREBASE ---------------------- */
const firebaseConfig = {
  // Estos valores deben ser los que te dio la consola de Firebase
  apiKey: "AIzaSyB42ikm2V5voMcLlnv4xVRSOdYaEnivHaw",
  authDomain: "reclamosdeserviestiba.firebaseapp.com",
  projectId: "reclamosdeserviestiba",
  storageBucket: "reclamosdeserviestiba.firebasestorage.app",
  messagingSenderId: "594034665663",
  appId: "1:594034665663:web:eac0eb961405dfce70be0a"
};
    /* --------------------------- INICIALIZACIONES --------------------------- */
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const appId = firebaseConfig.appId;

    // Configuración de EmailJS
    const EMAILJS_PUBLIC_KEY = "_t-n5RHgJXdbmjSmL";
    const EMAILJS_SERVICE_ID = "service_mh7ecio";
    const EMAILJS_TEMPLATE_ID_FORM = "template_6fmh15n"; // <-- Plantilla para el formulario inicial
    const EMAILJS_TEMPLATE_ID_HR = "template_ykhmz8d"; // <-- Plantilla para la respuesta de RRHH

    if (EMAILJS_PUBLIC_KEY) {
      // eslint-disable-next-line no-undef
      emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });
    }

    // Mapeo de usuarios a departamentos (quién ve el panel)
    const departmentUsers = {
      'alfonsochu@serviestibasa.com': 'GERENCIA',
      'davidhsu@serviestibasa.com': 'COMPRAS',
      'computo@serviestibasa.com': 'propietario',
      'rsalazar@serviestibasa.com': 'PLANILLA',
      'satencio@serviestibasa.com': 'MULTISERVICIOS',
     };

    // Estado global para vincular Reclamo seleccionado con el Panel RRHH
    let allClaimsData = [];
    let dashboardInitialized = false;
    let currentClaimId = null;
    let currentClaimInfo = null;

    document.addEventListener('DOMContentLoaded', () => {
      /* ----------------------- Referencias a elementos ---------------------- */
      const formSection = document.getElementById('form-section');
      const loginSection = document.getElementById('login-section');
      const dashboardSection = document.getElementById('dashboard-section');

      const loginForm = document.getElementById('login-form');
      const loginMessage = document.getElementById('login-message');
      const logoutBtn = document.getElementById('logout-btn');
      const goToDashboardBtn = document.getElementById('go-to-dashboard');
      const goBackToFormBtn = document.getElementById('go-back-to-form');

      const chapaInput = document.getElementById('chapa');
      const empresaSelect = document.getElementById('empresa');
      const chapaError = document.getElementById('chapa-error');
      const fechaHoraSpan = document.getElementById('fecha-hora-reclamo');

      const claimForm = document.getElementById('claim-form');
      const otroContainer = document.getElementById('otroContainer');
      const tipoReclamoCheckboxes = document.querySelectorAll('input[name="tipoReclamo"]');
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');
      const loadingSpinner = document.getElementById('loading-spinner');
      const claimIdMessage = document.getElementById('claim-id-message'); // Nuevo elemento para mostrar el ID

      const departmentTitle = document.getElementById('department-title');

      // Dashboard
      const claimsTableBodyPendientes = document.getElementById('claims-table-body-pendientes');
      const claimsTableBodyAtendidos = document.getElementById('claims-table-body-atendidos');
      const exportExcelBtn = document.getElementById('export-excel');
      const exportPdfBtn = document.getElementById('export-pdf');
      const exportWordBtn = document.getElementById('export-word');
      const dashboardContent = document.getElementById('dashboard-content');

      const modal = document.getElementById('modal');
      const modalContent = document.getElementById('modal-content');
      const closeModalBtn = document.getElementById('close-modal');

      /* -------------------------- Utilidades UI ----------------------------- */
      const showSection = (sectionToShow) => {
        formSection.classList.add('hidden');
        loginSection.classList.add('hidden');
        dashboardSection.classList.add('hidden');
        sectionToShow.classList.remove('hidden');
      };

      const updateDateTime = () => {
        const now = new Date();
        const formattedDate = now.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });
        const formattedTime = now.toLocaleTimeString('es-ES');
        fechaHoraSpan.textContent = `${formattedDate} - ${formattedTime}`;
      };
      updateDateTime();
      setInterval(updateDateTime, 1000);

      // Validación de chapa (6 dígitos o "ADM")
      chapaInput.addEventListener('input', () => {
        const value = chapaInput.value.trim();
        const isValid = /^\d{6}$/.test(value) || value.toUpperCase() === 'ADM';
        chapaError.textContent = (!isValid && value !== '') ? 'Debe ser 6 números o "ADM".' : '';
      });

      // "Otro" dinámico
      tipoReclamoCheckboxes.forEach(cb => {
        cb.addEventListener('change', () => {
          const otroCheckbox = document.getElementById('otro');
          otroContainer.style.display = (otroCheckbox && otroCheckbox.checked) ? 'block' : 'none';
        });
      });

      // Navegación
      goToDashboardBtn.addEventListener('click', () => showSection(loginSection));
      goBackToFormBtn?.addEventListener('click', () => showSection(formSection));

      /* ------------------------------ Envío --------------------------------- */
      claimForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        successMessage?.classList.add('hidden');
        errorMessage?.classList.add('hidden');
        claimIdMessage?.classList.add('hidden'); // Ocultar el mensaje del ID
        if (errorMessage) errorMessage.textContent = '';
        loadingSpinner?.classList.remove('hidden');

        // Validar Chapa y Empresa
        const chapaValue = chapaInput.value.trim();
        const isChapaValid = /^\d{6}$/.test(chapaValue) || chapaValue.toUpperCase() === 'ADM';
        if (!isChapaValid) {
          chapaError.textContent = 'Formato de Chapa incorrecto.';
          loadingSpinner?.classList.add('hidden');
          return;
        }
        if (!empresaSelect.value) {
          loadingSpinner?.classList.add('hidden');
          alert('Por favor seleccione una Empresa.');
          return;
        }

        const formData = new FormData(claimForm);

        const data = {
          nombre: formData.get('nombre') || '',
          apellidoPaterno: formData.get('apellidoPaterno') || '',
          apellidoMaterno: formData.get('apellidoMaterno') || '',
          cedula: formData.get('cedula') || '',
          chapa: formData.get('chapa') || '',
          empresa: formData.get('empresa') || '',
          cargo: formData.get('cargo') || '',
          posicion: formData.get('posicion') || '',
          grupo: formData.get('grupo') || '',
          celular: formData.get('celular') || '',
          email: formData.get('email') || '',
          tipoReclamo: formData.getAll('tipoReclamo'),
          otroDescripcion: formData.get('otroDescripcion') || '',
          detalle: formData.get('detalle') || '',
          fechaEnvio: serverTimestamp(),
          estado: 'Pendiente',
          historialRespuestas: [],
          rrhhData: {}
        };
        
        const collectionRef = collection(db, 'claimForms');
        const q = query(collectionRef);
        const querySnapshot = await getDocs(q);
        const serialNumber = querySnapshot.size + 1;

        data.serial = serialNumber;
        data.id = `REC-${serialNumber}`;

        const claimRef = doc(db, 'claimForms', data.id);

        try {
          await setDoc(claimRef, data);
          
          // Enviar correo de confirmación al usuario
          if (EMAILJS_PUBLIC_KEY && EMAILJS_SERVICE_ID && EMAILJS_TEMPLATE_ID_FORM) {
            try {
              // eslint-disable-next-line no-undef
              await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID_FORM, {
                to_email: data.email,
                to_name: `${data.nombre || ''} ${data.apellidoPaterno || ''}`.trim(),
                claim_id: data.id,
                claim_message: `Su reclamo ha sido recibido con el n\u00FAmero de referencia ${data.id}. Ser\u00e1 evaluado y le informaremos del resultado. Por favor, guarde este n\u00FAmero para futuras consultas.`
              });
              console.log('Correo de confirmación enviado.');
            } catch (err) {
              console.error('Error enviando EmailJS:', err);
            }
          }

          claimForm.reset();
          otroContainer.style.display = 'none';
          successMessage?.classList.remove('hidden');
          claimIdMessage.textContent = `Su reclamo ha sido enviado. El n\u00famero de referencia es: ${data.id}`;
          claimIdMessage?.classList.remove('hidden');
        } catch (error) {
          console.error("Error writing document: ", error);
          if (errorMessage) {
            errorMessage.textContent = `Hubo un error al enviar el reclamo. ${error?.code || ''} ${error?.message || ''}`;
            errorMessage.classList.remove('hidden');
          }
        } finally {
          loadingSpinner?.classList.add('hidden');
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });

      /* --------------------------- Inicio de sesión ------------------------- */
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = e.target.email.value.trim();
        const password = e.target.password.value;
        loginMessage.textContent = '';
        loginMessage.classList.add('hidden');
        try {
          await signInWithEmailAndPassword(auth, email, password);
        } catch (error) {
          console.error('Error de inicio de sesión:', error);
          loginMessage.textContent = 'Error: Usuario o contraseña incorrectos.';
          loginMessage.classList.remove('hidden');
        } 
      });

      logoutBtn.addEventListener('click', async () => {
        await signOut(auth);
      });


      /* ----------------        Dashboard y listeners       ------------------ */
      function initializeDashboard() {
        if (dashboardInitialized) return;
        dashboardInitialized = true;

        const collectionPath = "claimForms";
        const q = query(collection(db, collectionPath));


        onSnapshot(q, (querySnapshot) => {
          allClaimsData = [];
          claimsTableBodyPendientes.innerHTML = '';
          claimsTableBodyAtendidos.innerHTML = '';

          querySnapshot.forEach((docSnap) => {
            const data = docSnap.data();
            const id = docSnap.id;
            allClaimsData.push({ id, ...data });

            const fecha = data.fechaEnvio?.seconds ? new Date(data.fechaEnvio.seconds * 1000).toLocaleDateString() : 'N/A';
            const nombre = `${data.nombre || ''} ${data.apellidoPaterno || ''}`.trim();
            const tipo = data.tipoReclamo ? data.tipoReclamo.join(', ') : 'N/A';
            const estado = data.estado || 'Pendiente';

            const row = document.createElement('tr');
            row.className = 'border-b hover:bg-gray-50';

            let buttonText = 'Ver / Responder';
            let buttonClass = 'bg-blue-500 hover:bg-blue-600';
            if (estado === 'Resuelto' || estado === 'Rechazado') {
              buttonText = 'Ver Detalles';
              buttonClass = 'bg-gray-500 hover:bg-gray-600';
            }

            row.innerHTML = `
              <td class="p-4 text-center text-sm text-gray-900">${id || 'N/A'}</td>
              <td class="p-4 text-center text-sm text-gray-700">${fecha}</td>
              <td class="p-4 text-sm font-medium text-gray-900">${nombre}</td>
              <td class="p-4 text-center text-sm text-gray-700">${data.chapa || 'N/A'}</td>
              <td class="p-4 text-left text-sm text-gray-700">${tipo}</td>
              <td class="p-4 text-center text-sm">
                <span class="badge ${estado === 'Resuelto' ? 'bg-green-100 text-green-700' : estado === 'Rechazado' ? 'bg-red-100 text-red-700' : 'bg-gray-100 text-gray-700'}">${estado}</span>
              </td>
              <td class="p-4 text-center">
                <button class="view-btn px-3 py-1.5 text-sm font-semibold text-white ${buttonClass} rounded-lg shadow transition" data-id="${id}">${buttonText}</button>
              </td>
            `;

            if (estado === 'Pendiente') {
                claimsTableBodyPendientes.appendChild(row);
            } else {
                claimsTableBodyAtendidos.appendChild(row);
            }
          });

          document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const docId = e.currentTarget.dataset.id;
              const claim = allClaimsData.find(c => c.id === docId);
              showModal(claim);
            });
          });
        });

        // Exportar a Excel
        exportExcelBtn.addEventListener('click', () => {
          const rows = allClaimsData.map(c => ({
            'Serial': c.serial || 'N/A',
            'Fecha de Envío': c.fechaEnvio?.seconds ? new Date(c.fechaEnvio.seconds * 1000).toLocaleString() : 'N/A',
            'Nombre': `${c.nombre || ''} ${c.apellidoPaterno || ''} ${c.apellidoMaterno || ''}`.trim(),
            'Empresa': c.empresa || '',
            'Chapa': c.chapa || '',
            'Cédula': c.cedula || '',
            'Cargo': c.cargo || '',
            'Posición': c.posicion || '',
            'Grupo': c.grupo || '',
            'Celular': c.celular || '',
            'Email': c.email || '',
            'Tipo de Reclamo': c.tipoReclamo ? c.tipoReclamo.join(', ') : '',
            'Otro (desc.)': c.otroDescripcion || '',
            'Detalle': c.detalle || '',
            'Estado': c.estado || 'Pendiente',
            'RRHH - Procede': c.rrhhData?.solicitudProcede || '',
            'RRHH - Forma de Pago': c.rrhhData?.formaDePago || '',
            'RRHH - Fecha de Pago': c.rrhhData?.fechaDePago || '',
            'RRHH - Observaciones': c.rrhhData?.observaciones || '',
            'Última Respuesta': c.ultimaRespuesta?.texto || '',
            'Respondido Por': c.ultimaRespuesta?.por || '',
            'Fecha Respuesta': c.ultimaRespuesta?.fecha ? new Date(c.ultimaRespuesta.fecha).toLocaleString() : ''
          }));
          const ws = XLSX.utils.json_to_sheet(rows);
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "Reclamos");
          const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
          const blob = new Blob([excelBuffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });
          saveAs(blob, "Reclamos.xlsx");
        });

        // Exportar a Word
        exportWordBtn.addEventListener('click', () => {
          const header = `<h1 style="text-align:center;font-family:sans-serif;">Reporte de Reclamos</h1>`;
          const tableClone = document.getElementById('claims-table-pendientes').cloneNode(true);
          const tableClone2 = document.getElementById('claims-table-atendidos').cloneNode(true);
          const html = `
            <!DOCTYPE html>
            <html>
              <head>
                <meta charset="UTF-8">
                <style>
                  body{font-family:Arial, Helvetica, sans-serif}
                  table{border-collapse:collapse;width:100%;margin-bottom:20px}
                  th,td{border:1px solid #000;padding:8px}
                  th{background:#f3f4f6}
                </style>
              </head>
              <body>

                ${header}
                <h2>Reclamos Pendientes</h2>
                ${tableClone.outerHTML}
                <h2>Reclamos Atendidos</h2>
                ${tableClone2.outerHTML}

 <footer style="margin-top: 30px; font-size: 12px; text-align: center; color: #555;">
      <p>Este formulario es de uso exclusivo para colaboradores de 
        <b>Serviestiba S.A.</b>, <b>Portuario</b> y <b>Multiservicios</b>.
      </p>
      <p>La información solicitada se utiliza únicamente para fines internos de gestión.</p>
      <p>Contacto oficial: <a href="mailto:info@serviestibasa.com">info@serviestibasa.com</a></p>
    </footer>

              </body>
            </html>`;
          const blob = new Blob([html], { type: 'application/msword' });
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = 'Reclamos.doc';
          link.click();
        });

        // Exportar a PDF
        exportPdfBtn.addEventListener('click', async () => {
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p', 'pt', 'a4');
          const options = { scale: 2 };
          try {
            const canvas = await html2canvas(dashboardContent, options);
            const imgData = canvas.toDataURL('image/png');
            const imgWidth = 595.28;
            const pageHeight = 841.89;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            let heightLeft = imgHeight;
            let position = 0;

            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
            while (heightLeft >= 0) {
              position = heightLeft - imgHeight;
              pdf.addPage();
              pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
              heightLeft -= pageHeight;
            }
            pdf.save('Reclamos.pdf');
          } catch (err) {
            console.error('Error al generar el PDF:', err);
            alert('Hubo un error al generar el PDF. Por favor, intente de nuevo.');
          }
        });
      }

      function showModal(claim) {
        if (!claim) return;

        currentClaimId = claim.id;
        currentClaimInfo = claim;

        const isClosed = claim.estado === 'Resuelto' || claim.estado === 'Rechazado';
        
        let rrhhContent = '';
        if (isClosed) {
          rrhhContent = `
            <div class="mt-8 bg-gray-100 border border-gray-200 rounded-2xl shadow-lg p-6 transition-opacity">
              <h2 class="text-2xl font-extrabold text-gray-700">Reclamo Cerrado</h2>
              <p class="text-gray-600 mt-2">Este reclamo ha sido gestionado y su estado es **${claim.estado}**. No se pueden realizar más ediciones.</p>
              <div class="mt-4 text-sm text-gray-600">
                <p><strong>Observaciones:</strong> ${claim.rrhhData?.observaciones || 'No hay observaciones.'}</p>
                <p><strong>Fecha de Pago:</strong> ${claim.rrhhData?.fechaDePago || 'No aplica'}</p>
              </div>
            </div>
          `;
        } else {
          rrhhContent = `
            <div class="mt-8 bg-gradient-to-br from-indigo-50 to-white border border-gray-200 rounded-2xl shadow-lg p-6 transition-opacity">
              <div class="flex items-start justify-between gap-4 flex-wrap">
                <div>
                  <h2 class="text-2xl font-extrabold text-indigo-700">Gestión Interna RRHH</h2>
                  <p class="text-gray-600">Complete los campos internos de RRHH.</p>
                </div>
                <div class="text-right">
                  <div class="text-xs uppercase tracking-wide text-gray-500">Reclamo seleccionado</div>
                  <div class="text-sm font-semibold text-gray-800">ID: <span id="rrhh-selected-badge" class="px-2 py-0.5 rounded bg-gray-100 border border-gray-200">${claim.id}</span></div>
                  <div id="rrhh-selected-info" class="text-xs text-gray-600 mt-1">${claim.nombre || ''} ${claim.apellidoPaterno || ''} • ${claim.empresa || 'N/A'} • Chapa ${claim.chapa || 'N/A'}</div>
                </div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700">Solicitud Procede</label>
                  <div class="mt-2 flex items-center space-x-6">
                    <label class="flex items-center gap-2 text-sm">
                      <input id="rrhh-solicitud-si" type="radio" name="rrhh-solicitud" class="h-4 w-4 text-blue-600 border-gray-300"> Sí
                    </label>
                    <label class="flex items-center gap-2 text-sm">
                      <input id="rrhh-solicitud-no" type="radio" name="rrhh-solicitud" class="h-4 w-4 text-blue-600 border-gray-300"> No
                    </label>
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700">Forma de Pago</label>
                  <div class="mt-2 flex items-center space-x-6">
                    <label class="flex items-center gap-2 text-sm">
                      <input id="rrhh-pago-efectivo" type="radio" name="rrhh-pago" class="h-4 w-4 text-blue-600 border-gray-300"> Efectivo
                    </label>
                    <label class="flex items-center gap-2 text-sm">
                      <input id="rrhh-pago-cheque" type="radio" name="rrhh-pago" class="h-4 w-4 text-blue-600 border-gray-300"> Cheque
                    </label>
                    <label class="flex items-center gap-2 text-sm">
                      <input id="rrhh-pago-ach" type="radio" name="rrhh-pago" class="h-4 w-4 text-blue-600 border-gray-300"> ACH
                    </label>
                  </div>
                </div>

                <div>
                  <label for="rrhh-fecha-pago" class="block text-sm font-medium text-gray-700">Fecha de Pago</label>
                  <input type="date" id="rrhh-fecha-pago" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>

                <div>
                  <label for="rrhh-observaciones" class="block text-sm font-medium text-gray-700">Observaciones</label>
                  <textarea id="rrhh-observaciones" rows="3" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Notas internas del caso..."></textarea>
                </div>
              </div>

              <div class="mt-6 flex items-center justify-between">
                <div id="rrhh-save-msg" class="text-sm text-gray-600"></div>
                <div class="flex items-center gap-4">
                  <button id="rrhh-save-btn" class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow hover:bg-indigo-700 transition">
                    Guardar Gestión RRHH
                  </button>
                  <button id="rrhh-send-email-btn" class="px-6 py-2 bg-purple-600 text-white font-semibold rounded-lg shadow hover:bg-purple-700 transition">
                    Enviar Respuesta
                  </button>
                </div>
              </div>
            </div>
          `;
        }

        modalContent.innerHTML = `
          <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-indigo-400 pb-2 text-center">Detalles del Reclamo</h3>
          <div class="space-y-4 p-4 bg-gray-50 rounded-lg shadow-inner">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <p class="font-semibold text-gray-700">Chapa:</p>
                <p class="text-gray-900">${claim.chapa || 'N/A'}</p>
              </div>
              <div>
                <p class="font-semibold text-gray-700">Nombre y Apellidos:</p>
                <p class="text-gray-900">${claim.nombre || ''} ${claim.apellidoPaterno || ''} ${claim.apellidoMaterno || ''}</p>
              </div>
            </div>
            <div>
              <p class="font-semibold text-gray-700">Tipo de Reclamo:</p>
              <p class="text-gray-900">${claim.tipoReclamo ? claim.tipoReclamo.join(', ') : 'N/A'}</p>
            </div>
            <div>
              <p class="font-semibold text-gray-700">Detalle del Reclamo:</p>
              <p class="text-gray-900">${claim.detalle || 'N/A'}</p>
            </div>
          </div>
          ${rrhhContent}
        `;

        if (!isClosed) {
          // LÓGICA DE GESTIÓN RRHH SOLO PARA RECLAMOS PENDIENTES
          const rrhhProcedeSi = document.getElementById('rrhh-solicitud-si');
          const rrhhProcedeNo = document.getElementById('rrhh-solicitud-no');
          const rrhhPagoEf = document.getElementById('rrhh-pago-efectivo');
          const rrhhPagoCh = document.getElementById('rrhh-pago-cheque');
          const rrhhPagoAch = document.getElementById('rrhh-pago-ach');
          const rrhhFecha = document.getElementById('rrhh-fecha-pago');
          const rrhhObs = document.getElementById('rrhh-observaciones');
          const rrhhSaveBtn = document.getElementById('rrhh-save-btn');
          const rrhhSendEmailBtn = document.getElementById('rrhh-send-email-btn');
          const rrhhSaveMsg = document.getElementById('rrhh-save-msg');

          // Función para poblar el panel (usada ahora dentro del modal)
          function populateRRHHPanel(claim) {
            [rrhhProcedeSi, rrhhProcedeNo, rrhhPagoEf, rrhhPagoCh, rrhhPagoAch].forEach(r => r.checked = false);
            rrhhFecha.value = '';
            rrhhObs.value = '';

            const r = claim.rrhhData || {};
            if (r.solicitudProcede === 'Sí') rrhhProcedeSi.checked = true;
            if (r.solicitudProcede === 'No') rrhhProcedeNo.checked = true;

            if (r.formaDePago === 'Efectivo') rrhhPagoEf.checked = true;
            if (r.formaDePago === 'Cheque') rrhhPagoCh.checked = true;
            if (r.formaDePago === 'ACH') rrhhPagoAch.checked = true;

            if (r.fechaDePago) {
              try {
                const d = new Date(r.fechaDePago);
                if (!isNaN(d)) {
                  const yyyy = d.getFullYear();
                  const mm = String(d.getMonth() + 1).padStart(2, '0');
                  const dd = String(d.getDate()).padStart(2, '0');
                  rrhhFecha.value = `${yyyy}-${mm}-${dd}`;
                } else {
                  rrhhFecha.value = r.fechaDePago;
                }
              } catch {
                rrhhFecha.value = r.fechaDePago;
              }
            }
            rrhhObs.value = r.observaciones || '';
          }

          // Se llama a la función para rellenar los datos del reclamo seleccionado
          populateRRHHPanel(claim);

          // Guardar Gestión RRHH (se redefine dentro del modal)
          rrhhSaveBtn.addEventListener('click', async () => {
            rrhhSaveMsg.textContent = '';
            if (!currentClaimId) {
              rrhhSaveMsg.textContent = 'Seleccione un reclamo (abra "Ver / Responder").';
              rrhhSaveMsg.className = 'text-sm text-red-600';
              return;
            }

            const rrhhData = {
              solicitudProcede: rrhhProcedeSi.checked ? 'Sí' : (rrhhProcedeNo.checked ? 'No' : ''),
              formaDePago: rrhhPagoEf.checked ? 'Efectivo' : rrhhPagoCh.checked ? 'Cheque' : rrhhPagoAch.checked ? 'ACH' : '',
              fechaDePago: rrhhFecha.value || '',
              observaciones: rrhhObs.value || ''
            };

            const nuevoEstado = rrhhData.solicitudProcede === 'Sí' ? 'Resuelto' : (rrhhData.solicitudProcede === 'No' ? 'Rechazado' : 'Pendiente');

            const respuestaObj = {
              texto: rrhhData.observaciones || 'Sin respuesta',
              por: 'RRHH',
              fecha: Date.now()
            };
            
            try {
              const ref = doc(db, `claimForms`, currentClaimId);
              await updateDoc(ref, { 
                rrhhData: rrhhData,
                estado: nuevoEstado,
                historialRespuestas: arrayUnion(respuestaObj)
              });
              rrhhSaveMsg.textContent = 'Gestión RRHH guardada correctamente.';
              rrhhSaveMsg.className = 'text-sm text-green-600';
            } catch (err) {
              console.error('Error guardando gestión RRHH:', err);
              rrhhSaveMsg.textContent = 'No se pudo guardar. Intente nuevamente.';
              rrhhSaveMsg.className = 'text-sm text-red-600';
            }
          });

          // Enviar respuesta por correo electrónico
          rrhhSendEmailBtn.addEventListener('click', async () => {
              if (!currentClaimInfo || !currentClaimInfo.email) {
                  rrhhSaveMsg.textContent = 'No se pudo enviar el correo. Faltan datos del colaborador.';
                  rrhhSaveMsg.className = 'text-sm text-red-600';
                  return;
              }

              const rrhhData = {
                  solicitudProcede: rrhhProcedeSi.checked ? 'Sí' : (rrhhProcedeNo.checked ? 'No' : ''),
                  formaDePago: rrhhPagoEf.checked ? 'Efectivo' : rrhhPagoCh.checked ? 'Cheque' : rrhhPagoAch.checked ? 'ACH' : '',
                  fechaDePago: rrhhFecha.value || '',
                  observaciones: rrhhObs.value || ''
              };

              const nuevoEstado = rrhhData.solicitudProcede === 'Sí' ? 'Resuelto' : (rrhhData.solicitudProcede === 'No' ? 'Rechazado' : 'Pendiente');

              const respuestaObj = {
                  texto: rrhhData.observaciones || 'Sin respuesta',
                  por: 'RRHH',
                  fecha: Date.now()
              };

              try {
                  // Paso 1: Actualizar el estado del reclamo en la base de datos
                  const ref = doc(db, `claimForms`, currentClaimId);
                  await updateDoc(ref, {
                      rrhhData: rrhhData,
                      estado: nuevoEstado,
                      historialRespuestas: arrayUnion(respuestaObj)
                  });
                  
                  // Paso 2: Enviar el correo electrónico
                  await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID_HR, {
                      to_email: currentClaimInfo.email,
                      to_name: `${currentClaimInfo.nombre || ''} ${currentClaimInfo.apellidoPaterno || ''}`.trim(),
                      claim_id: currentClaimInfo.id,
                      claim_message: `Su reclamo con el ID ${currentClaimInfo.id} ha sido evaluado. Le informamos que su reclamo ${rrhhData.solicitudProcede === 'Sí' ? 'procede' : 'no procede'}.
                      \n\nObservaciones: \n${rrhhData.observaciones || 'Se ha completado la gestión de su reclamo.'}
                      \n\nGracias por su cooperación.`
                  });

                  rrhhSaveMsg.textContent = 'Respuesta enviada y gestión guardada.';
                  rrhhSaveMsg.className = 'text-sm text-green-600';
                  modal.classList.remove('modal-active');
              } catch (err) {
                  console.error('Error al guardar o enviar el correo:', err);
                  rrhhSaveMsg.textContent = 'Hubo un error. Revise su configuración de EmailJS y la base de datos.';
                  rrhhSaveMsg.className = 'text-sm text-red-600';
              }
          });
        }

        modal.classList.add('modal-active');
      }

      closeModalBtn.addEventListener('click', () => modal.classList.remove('modal-active'));

      onAuthStateChanged(auth, (user) => {
        if (user && departmentUsers[user.email]) {
          showSection(dashboardSection);
          departmentTitle.textContent = `Panel de Control de Reclamos - ${departmentUsers[user.email]}`;
          initializeDashboard();
        } else {
          showSection(formSection);
        }
      });
    });
  </script>
</head>

<body class="bg-gradient-to-r from-blue-500 to-indigo-600 p-8 flex flex-col items-center justify-center font-sans antialiased">
    <div class="w-full max-w-4xl">
        <div id="form-section" class="bg-white p-6 sm:p-10 rounded-3xl shadow-2xl w-full max-w-4xl transform transition-all duration-500">
            <header class="flex flex-col sm:flex-row justify-between items-center mb-6 border-b-2 pb-4">
                <div class="flex items-center justify-between w-full">
                    <div class="flex-shrink-0">
                        <img src="serviestiba_logo.png" alt="Serviestiba S.A." class="h-16 w-16">
                    </div>

                    <div class="flex flex-col items-center flex-grow mx-4">
                        <h1 class="text-3xl sm:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-700 to-purple-600 tracking-wide leading-tight text-center">
                            FORMULARIO DE RECLAMO
                        </h1>
                        <p class="text-xs sm:text-sm text-gray-500 mt-2 text-center">
                            Solo uso exclusivo para el personal de <b>Serviestiba S.A.</b>, <b>Portuario</b> y <b>Multiservicios</b>
                        </p>
                    </div>

                    <div class="flex-shrink-0">
                        <img src="multiservicios_logo.png" alt="Multiservicios" class="h-16 w-16">
                    </div>
                </div>
            </header>
    
            <form id="claim-form" class="space-y-6">
                <div class="flex flex-wrap items-center gap-4 justify-between mb-4">
                    <div class="text-sm">
                        <span class="font-bold">Fecha y Hora:</span> <span id="fecha-hora-reclamo"></span>
                    </div>
                    <div class="flex items-center gap-3">
                        <label for="chapa" class="font-bold">Chapa:</label>
                        <input type="text" id="chapa" name="chapa" class="p-1 border-b-2 border-gray-300 focus:border-blue-500 w-32 outline-none">
                        <label for="empresa" class="font-bold ml-4">Empresa:</label>
                        <select id="empresa" name="empresa" class="p-1 border-b-2 border-gray-300 focus:border-blue-500 w-56 outline-none" required>
                            <option value="">Seleccione una empresa</option>
                            <option value="SERVIESTIBA">SERVIESTIBA</option>
                            <option value="PORTUARIO">PORTUARIO</option>
                            <option value="MULTISERVICIO">MULTISERVICIO</option>
                        </select>
                    </div>
                </div>
                <p id="chapa-error" class="text-xs text-red-500 -mt-1 mb-4"></p>
                
                <fieldset class="border-2 border-gray-200 p-6 rounded-xl">
                    <legend class="px-2 text-lg font-bold text-gray-800">Datos del Colaborador</legend>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4 mt-4">
                        <div>
                            <label for="nombre" class="block text-sm font-medium text-gray-700">Nombre</label>
                            <input type="text" id="nombre" name="nombre" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
                        </div>
                        <div>
                            <label for="apellidoPaterno" class="block text-sm font-medium text-gray-700">Apellido Paterno</label>
                            <input type="text" id="apellidoPaterno" name="apellidoPaterno" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
                        </div>
                        <div>
                            <label for="apellidoMaterno" class="block text-sm font-medium text-gray-700">Apellido Materno</label>
                            <input type="text" id="apellidoMaterno" name="apellidoMaterno" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>

                        <div>
                            <label for="cedula" class="block text-sm font-medium text-gray-700">Cédula</label>
                            <input type="text" id="cedula" name="cedula" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
                        </div>
                        <div> 
                            <label for="posicion" class="block text-sm font-medium text-gray-700">Posición</label>
                            <select id="posicion" name="posicion" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                <option value="">Seleccione la posición</option>
                                <option value="">ABOGADO</option>
                                <option value="">ALMACENISTA</option>
                                <option value="">ASESOR DE TALLER</option>
                                <option value="">ASISTENTE CONTABLE</option>
                                <option value="">ASISTENTE</option>
                                <option value="">AYUDANTE</option>
                                <option value="">CORDINADO DE REEFER</option>
                                <option value="">CORDINADOR DE TRINCA</option>
                                <option value="">CORDINADOR LEGAL</option>
                                <option value="">GERENTES</option>
                                <option value="">INSTRUCTOR DE REEFER</option>
                                <option value="">JEFES</option>
                                <option value="">LABOR CONTROL</option>
                                <option value="">LAVADOR</option>
                                <option value="">LLANTERO</option>
                                <option value="">MECANICO</option>
                                <option value="">MEDICO OCUPACIONAL</option>
                                <option value="">OFICIALES</option>
                                <option value="">PERIODISTA</option>
                                <option value="">SOLDADOR</option>
                                <option value="">SUBGERENTES</option>
                                <option value="">SUPERINTENDENTES</option>
                                <option value="">SUPERVISORES</option>
                                <option value="">TECNICO DE A/A</option>
                                <option value="">TECNICO EN INFORMATICO</option>
                                <option value="">ESTIBADOR</option>
                                <option value="">OPERADO DE EQUIPO PESADO</option>
                                <option value="">OPERADOR DE TRACTOR Y REMOLQUE</option>
                                <option value="">TEJEDOR DE CABLE</option>
                                <option value="">VERIFICADORES</option>
                                <option value="">WINCHERO</option>
                                <option value="">CONDUCTOR</option>
                            </select>
                        </div>
                        <div>
                            <label for="grupo" class="block text-sm font-medium text-gray-700">Grupo</label>
                            <select id="grupo" name="grupo" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                <option value="">Seleccione su grupo</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="c">C</option>
                                <option value="c">D</option>
                                <option value="Asignados">Asignados</option>
                            </select>
                        </div>
                        <div>
                            <label for="celular" class="block text-sm font-medium text-gray-700">Celular / Whatsapp</label>
                            <input type="tel" id="celular" name="celular" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" id="email" name="email" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="border-2 border-gray-200 p-6 rounded-xl">
                    <legend class="px-2 text-lg font-bold text-gray-800">Tipo de Reclamo</legend>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-8">
                        <div class="space-y-4">
                            <div class="flex items-center">
                                <input id="tiempoNoComputado" name="tipoReclamo" type="checkbox" value="Tiempo no computado" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <label for="tiempoNoComputado" class="ml-2 block text-sm text-gray-900">Tiempo no computado</label>
                            </div>
                            <div class="flex items-center">
                                <input id="viacticos" name="tipoReclamo" type="checkbox" value="Viáticos" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <label for="viacticos" class="ml-2 block text-sm text-gray-900">Viáticos</label>
                            </div>
                            <div class="flex items-center">
                                <input id="incapacidades" name="tipoReclamo" type="checkbox" value="Incapacidades" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <label for="incapacidades" class="ml-2 block text-sm text-gray-900">Incapacidades</label>
                            </div>
                            <div class="flex items-center">
                                <input id="inclusionExclusionAcreedor" name="tipoReclamo" type="checkbox" value="Inclusión/exclusión de acreedor" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <label for="inclusionExclusionAcreedor" class="ml-2 block text-sm text-gray-900">Inclusión/exclusión de acreedor</label>
                            </div>
                            <div class="flex items-center">
                                <input id="rataSalarial" name="tipoReclamo" type="checkbox" value="Rata salarial" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <label for="rataSalarial" class="ml-2 block text-sm text-gray-900">Rata salarial</label>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center">
                                <input id="comida" name="tipoReclamo" type="checkbox" value="Comida" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <label for="comida" class="ml-2 block text-sm text-gray-900">Comida</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bono" name="tipoReclamo" type="checkbox" value="Bono" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <label for="bono" class="ml-2 block text-sm text-gray-900">Bono</label>
                            </div>
                            <div class="flex items-center">
                                <input id="xiiiMes" name="tipoReclamo" type="checkbox" value="XIII Mes" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <label for="xiiiMes" class="ml-2 block text-sm text-gray-900">XIII Mes</label>
                            </div>
                            <div class="flex items-center">
                                <input id="reemvolsoODevolucion" name="tipoReclamo" type="checkbox" value="Reembolso o devolución" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <label for="reemvolsoODevolucion" class="ml-2 block text-sm text-gray-900">Reembolso o devolución</label>
                            </div>
                            <div class="flex items-center">
                                <input id="otro" name="tipoReclamo" type="checkbox" value="Otro" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <label for="otro" class="ml-2 block text-sm text-gray-900">Otro</label>
                            </div>
                        </div>
                    </div>
                    <div id="otroContainer" class="mt-4">
                        <label for="otroDescripcion" class="block text-sm font-medium text-gray-700">Por favor, especifique el tipo de reclamo:</label>
                        <input type="text" id="otroDescripcion" name="otroDescripcion" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                </fieldset>

                <div class="space-y-4">
                    <div>
                        <label for="detalle" class="block text-sm font-medium text-gray-700">Detalle del Reclamo</label>
                        <textarea id="detalle" name="detalle" rows="4" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required></textarea>
                    </div>
                </div>
                <div class="flex flex-col items-center gap-4 mt-6">
                    <button type="submit" class="w-full sm:w-auto px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-bold rounded-lg shadow-lg hover:from-blue-700 hover:to-indigo-800 transition-all duration-300 ease-in-out transform hover:scale-105">
                        Enviar Reclamo
                    </button>
                    <button id="go-to-dashboard" type="button" class="w-full sm:w-auto px-6 py-3 bg-gray-500 text-white font-bold rounded-lg shadow-lg hover:bg-gray-600 transition-all duration-300 ease-in-out transform hover:scale-105">
                        Ir al Panel de Control
                    </button>
                </div>
                <div id="loading-spinner" class="hidden text-center mt-4">
                    <svg class="animate-spin h-8 w-8 text-blue-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>
                <div id="success-message" class="hidden text-center mt-4 p-4 rounded-lg bg-green-100 text-green-700 font-medium">
                    ¡Reclamo enviado con éxito!
                </div>
                <div id="claim-id-message" class="hidden text-center mt-2 font-semibold text-gray-600"></div>
                <div id="error-message" class="hidden text-center mt-4 p-4 rounded-lg bg-red-100 text-red-700 font-medium">
                    Hubo un error al enviar el reclamo. Por favor, inténtelo de nuevo.
                </div>
            </form>
        </div>
    </div>
    
  <div id="login-section" class="hidden bg-white p-8 sm:p-12 rounded-3xl shadow-2xl w-full max-w-md transform transition-all duration-500">
    <header class="text-center mb-8">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-teal-700 to-cyan-800 tracking-wide leading-tight">
        Acceso de Gerencia
      </h1>
      <p class="text-gray-600 mt-2">Inicie sesión para ver los reclamos</p>
    </header>
    <form id="login-form" class="space-y-6">
      <div>
        <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
        <input type="email" id="email" name="email" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 sm:text-sm" required>
      </div>
      <div>
        <label for="password" class="block text-sm font-medium text-gray-700">Contraseña</label>
        <input type="password" id="password" name="password" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 sm:text-sm" required>
      </div>
      <div id="login-message" class="text-center text-red-600 font-semibold hidden"></div>
      <div class="flex flex-col items-center gap-4 mt-6">
        <button type="submit" class="w-full px-4 py-3 bg-gradient-to-r from-teal-500 to-cyan-600 text-white font-bold rounded-lg shadow-lg hover:from-teal-600 hover:to-cyan-700 focus:outline-none focus:ring-4 focus:ring-teal-300 transition-all duration-300 ease-in-out transform hover:scale-105">
          Iniciar Sesión
        </button>
        <button id="go-back-to-form" type="button" class="w-full sm:w-auto px-6 py-3 bg-gray-500 text-white font-bold rounded-lg shadow-lg hover:bg-gray-600 transition-all duration-300 ease-in-out transform hover:scale-105">
          Volver al Formulario
        </button>
      </div>
    </form>
  </div>
  <div id="dashboard-section" class="hidden bg-white p-6 sm:p-10 rounded-3xl shadow-2xl w-full max-w-7xl transform transition-all duration-500">
    <div id="dashboard-content">
      <header class="mb-8 text-center">
        <h1 id="department-title" class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-700 to-purple-600 tracking-wide leading-tight">Panel de Control de Reclamos</h1>
        <p class="text-xl text-gray-700 font-light mt-2">Visor, respuesta y exportación de solicitudes</p>
        <div class="mt-4 flex flex-wrap justify-center gap-4">
          <button id="export-excel" class="px-6 py-2 bg-green-600 text-white font-semibold rounded-full shadow-lg hover:bg-green-700 transition">Exportar a Excel</button>
          <button id="export-pdf" class="px-6 py-2 bg-red-600 text-white font-semibold rounded-full shadow-lg hover:bg-red-700 transition">Exportar a PDF</button>
          <button id="export-word" class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-full shadow-lg hover:bg-blue-700 transition">Exportar a Word</button>
          <button id="logout-btn" class="px-6 py-2 bg-gray-500 text-white font-semibold rounded-full shadow-lg hover:bg-gray-600 transition">Cerrar Sesión</button>
        </div>
      </header>

      <h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4">Reclamos Pendientes</h2>
      <div class="table-container bg-gray-50 rounded-2xl shadow-inner border border-gray-200">
        <table id="claims-table-pendientes" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-100 sticky top-0 z-10">
            <tr>
              <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Serial</th>
              <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Fecha</th>
              <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Nombre</th>
              <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Chapa</th>
              <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Tipo de Reclamo</th>
              <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Estado</th>
              <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Acciones</th>
            </tr>
          </thead>
          <tbody id="claims-table-body-pendientes" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>

      <h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4">Reclamos Atendidos</h2>
      <div class="table-container bg-gray-50 rounded-2xl shadow-inner border border-gray-200">
        <table id="claims-table-atendidos" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-100 sticky top-0 z-10">
            <tr>
              <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Serial</th>
              <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Fecha</th>
              <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Nombre</th>
              <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Chapa</th>
              <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Tipo de Reclamo</th>
              <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Estado</th>
              <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Acciones</th>
            </tr>
          </thead>
          <tbody id="claims-table-body-atendidos" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="modal" class="modal fixed inset-0 z-50 overflow-auto bg-gray-800 bg-opacity-75 items-center justify-center p-4">
    <div class="relative bg-white p-8 rounded-2xl shadow-xl w-full max-w-2xl mx-auto transform transition-all duration-300 scale-95">
      <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
      <div id="modal-content"></div>
    </div>
  </div>

      <footer style="margin-top: 30px; font-size: 12px; text-align: center; color: #555;">
      <p>Este formulario es de uso exclusivo para colaboradores de 
        <b>Serviestiba S.A.</b>, <b>Portuario</b> y <b>Multiservicios</b>.
      </p>
      <p>La información solicitada se utiliza únicamente para fines internos de gestión.</p>
      <p>Contacto oficial: <a href="mailto:info@serviestibasa.com">info@serviestibasa.com</a></p>
    </footer>

</body>
</html>
